---
layout: post
title: Calculating the position of a pitched baseball in flight
image: /public/images/calculating_pitch_location.jpg
summary: >
    With the help of PITCHf/x data and some simple physics, it's easy to calculate and plot and flight path of a pitched baseball. First we'll do the math, and then we'll use D3.js to plot the flightpath.
mathjax: true
date: 2020-01-01
---

The [PITCHf/x](http://en.wikipedia.org/wiki/PITCHf/x) system is a marvel. Though it has only been used in the regular season for seven years, it's already hard to imagine baseball without it. What's even more amazing is that the data generated by the system is made available for general (non-commercial, obviously) use, so you don't have to be an ESPN analyst to play with it.

Having never played professional baseball (or even non-professional baseball at high levels -- my little league career was the apex of my on-field baseball glory), I've always wanted to know what it feels like to stand in the batter's box and face down a major league pitcher. While I'll probably never *really* know what it's like to be brushed back by high heat, I can at very least visualize what it's like now with data and some simple physics.

### The model

PITCHf/x uses [a nine-parameter model](http://baseball.physics.illinois.edu/PitchFX_9P_Model-4.pdf) to turn pixel-level data returned by cameras mounted around the field into a constant-acceleration model used to plot the ball's trajectory. Given the starting location of the ball, three velocity vectors at Time 0, and three acceleration vectors (that are treated as constant throughout the flight of the pitch), a reasonably good approximation of the ball's flightpath can be plotted (though it falls down with the knuckleball, I suppose, as in-flight variations of the trajectory are what make it difficult to hit, but pretty much everything falls down with the knuckleball, doesn't it?).

### The axes

It's important to visualize the axes used by the PITCHf/x data.

From the catcher's perspective:

* **X**: is negative to the left, and positive to the right. Thus a right-handed pitcher will release the ball with a negative X position, and a left-handed pitcher will release the ball with a positive X position.
* **Y**: is positive going outward toward the pitcher. 0 is the back of home plate and (in the data I'm using, which has been adjusted slightly -- see below) the ball is released at y=55 (feet).
* **Z**: is positive going up away from the ground, so a pitch will fall from some positive value at release to zero when it hits the ground.

### The data

I'm using data from [Brooks Baseball](http://www.brooksbaseball.net/), which has been adjusted from the raw PITCHf/x data in a couple of ways:

* The release point has been pushed back from 50ft to 55ft, "which more closely reflects the actual release distance of most pitchers."
* The initial velocity vectors have been massaged to try to eliminate bias introduced by different stadiums having ever so slightly different camera installations.

It comes in the form of nine floating points numbers. For this exercise we'll use the curveball that Adam Wainwright used to strike out Hunter Pence to end the sixth inning of NLCS Game 5 (you can see it [at ~58 seconds on this highlight clip](http://m.mlb.com/video/v36821571/nlcs-gm5-waino-fans-seven-over-seven-stellar-frames/?game_pk=416376)). It looks like this:

<table>
    <tr>
        <th>x0</th>
        <th>y0</th>
        <th>z0</th>
    </tr>
    <tr>
        <td>-0.736549975</td>
        <td>55</td>
        <td>6.393668382</td>
    </tr>
    <tr>
        <th>vx0</th>
        <th>vy0</th>
        <th>vz0</th>
    </tr>
    <tr>
        <td>1.676496827</td>
        <td>-114.4539208</td>
        <td>1.664495387</td>
    </tr>
    <tr>
        <th>ax0</th>
        <th>ay0</th>
        <th>az0</th>
    </tr>
    <tr>
        <td>8.258000427</td>
        <td>25.12500049</td>
        <td>-43.31700143</td>
    </tr>
</table>

It took me a while to develop any sort of intuition about these numbers, so I'm going to talk a little about them here because I think it's important to be able to look at a raft of numbers like this and understand a few things about them (feel free to skip over this if you can already see a baseball curving through the air when you look at the table above).

The single largest magnitude is `vy0` at -114.5. Remember that the y-axis is horizontal between the pitcher and the batter, with zero being the back of home plate. Thus the large negative vector indicates speed in the direction of the plate, which makes sense given that this is at release and one would expect the ball to be heading toward the plate in one way or another.

The second largest magnitude is `az0` at -43.32. Most of this is gravity, which is accelerating everything toward the ground at ~32.2 ft/s^2. However this means that the pitch ultimately is falling toward the ground ~33% than one would expect from gravity alone. This isn't surprising given that it's a nasty 12-6 curveball, but interesting to see quantified nonetheless.

The third largest magnitude is `ay0` at 25.13, which mostly represents the effect of air resistance on the ball.

Finally, let's look at the horizontal release position. Wainwright is a RHP, `x0` starts as a negative number -- -0.74. Given that he's throwing toward the plate, which is centered on a line between the pitcher's mound and the backstop, it's not surprising that there's positive horizontal velocity (`vx0`) at release. What's interesting is how much greater the horizontal acceleration (`ax0`) is -- Wainwright's arm isn't moving horizontally very much at release, but the ball ends up with a significant horizontal acceleration across his body regardless.

### The math

Now that we have this data, it's pretty easy to calculate where on this curve the ball will be at any given point of time in its flight. When acceleration is constant and initial velocities are known, you can use [the kinematic equations](http://www.physicsclassroom.com/class/1DKin/Lesson-6/Kinematic-Equations) to calculate the displacement at any point in time. The one we want is:

<p>$$d = v_0t + \frac{1}{2}a_0t^2$$</p>

So, the displacement `d` is equal to the velocity at t=0 `v0` times the amount of time that has passed `t`, plus half the acceleration `a0` multiplied by the square of the amount of time that has passed. However, we already have a starting location (the pitch release point) so we need to add that into the equation. That leaves us with a final equation for `d` at some time `t` as:

<p>$$d = d_0 + v_0t + \frac{1}{2}a_0t^2$$</p>

Where `d0` is the location of the initial release point.

Now we have a way to determine the location of the ball at any point during its flight (by changing the value of `t`, and calculating for all three axes). Now then what should we actually calculate?

### The calculation

There are three important points during the lifecycle of a pitch that we're concerned about:

1. When the ball crosses the front of the plate.
2. When the ball crosses the back of the plate (and lands in the catcher's mitt).
3. When the ball hits the ground (which may happen before either of these events).

If the ball is plotted to hit the ground after passing over the plate then we can safely ignore that calculation. A regulation home plate is 1.417 feet from front to back, so #1 occurs at `y=1.417`, while #2 occurs at `y=0`. Calculating at intervals of a 100 milliseconds gives the following results (ending when `z <= 0` -- that is, when the ball hits the ground):

<div id="sample_calculation"></div>

{% javascript pitch_trajectory %}
